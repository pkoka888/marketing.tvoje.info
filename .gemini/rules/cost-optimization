# Cost Optimization Rule — Canonical Version
# All other agent dirs reference or mirror this file.

## Budget (STRICT)

- **T1 Free (Primary)**: Unlimited via Kilo Gateway
- **T2 Complex (Secondary)**: Gemini 2.5 Pro (Free Tier - 1M TPD)
- **T3 Architect (Orchestrator)**: Antigravity / Gemini 2.5 Pro (Free Quota)
- **T4 Paid (Last Resort)**: $20/month max cap (OpenAI/Groq)

## Kilo Gateway Free Models (2026-02)

⚠️ **IMPORTANT**: Kilo Code uses `:free` suffix for ALL free models EXCEPT `giga-potato` (no suffix).

| Model | Format | Best For | Status |
| ----- | ------ | -------- | ------ |
| `grok-code-fast-1` | `:optimized:free` | Bulk coding, code synthesis | ✅ Free |
| `minimax-m2.1` | `:free` | General-purpose, strong performance | ✅ Free |
| `glm-4.7` | `:free` | Agent-centric applications | ✅ Free |
| `kimi-k2.5` | `:free` | Tool use, reasoning, code synthesis | ✅ Free |
| `giga-potato` | `(none)` | Evaluation period (no suffix) | ✅ Free |
| `trinity-large` | `:free` | Preview model | ✅ Free |

## OpenRouter Free Models (Require Account)

| Model | Best For | Status |
| ----- | -------- | ------ |
| `qwen3-coder` | Agentic coding, function calling | ✅ Free |
| `glm-4.5-air` | Lightweight agent tasks | ✅ Free |
| `deepseek-r1` | OpenAI o1-level performance | ✅ Free |
| `kimi-k2` | Tool use, reasoning | ✅ Free |

## Routing Matrix

| Task Type | Agent | Model | Tier |
| --------- | ----- | ----- | ---- |
| Bulk coding | Kilo CLI | `x-ai/grok-code-fast-1:optimized:free` | T1 Free |
| Routine fixes | OpenCode | `big-pickle` | T1 Free |
| Research | Gemini CLI | `gemini-2.5-flash` | T2 Free |
| Planning | Cline | `minimax-m2.5` | T1 Free |
| Agent tasks | Kilo CLI | `minimax-m2.1:free` | T1 Free |
| Code synthesis | Kilo CLI | `x-ai/grok-code-fast-1:optimized:free` | T1 Free |
| **Fallback** | Groq | `llama-3.3-70b` | **T4 Paid** |

## Multi-Platform Free Models (2026-02)

### Kilo Code (Primary)
- `minimax-m2.1` → `:free` suffix
- `glm-4.7` → `:free` suffix  
- `kimi-k2.5` → `:free` suffix
- `giga-potato` → no suffix

### Cline (via OpenRouter)
- `minimax-m2.5` → preferred (limited time Feb 2026)
- `minimax-m2.1` → fallback
- `kimi-k2.5` → free via OpenRouter

### OpenCode
- `big-pickle` → GLM-4.6 stealth model (limited time)
- `glm-5` → free
- `kimi-k2.5` → free
- `minimax-m2.5` → free

### LiteLLM (Self-Hosted Proxy)
See `litellm/proxy_config.yaml` for full config:
- T1: `gemini-flash`, `gemini-pro` (Google Free Tier - Use First)
- T2: `qwen3-coder-free`, `deepseek-r1-free` (OpenRouter Free - No Credits Needed)
- T3: `groq-llama-8b`, `groq-llama-70b` (Pay-per-token - Use as Last Resort)
- T4: `gpt-4o-mini` (OpenAI Paid - Most Expensive)
## How to Verify Current Free Models

**Method 1: IDE Model Picker**
- Open Kilo Code extension
- Click model name below chat window
- Look for "(free)" label

**Method 2: CLI Command**
```bash
kilo
/models
```

**Method 3: Documentation**
- Visit: https://kilo.ai/docs/code-with-ai/agents/free-and-budget-models
- Subscribe to Kilo Discord/Blog for updates



## Resource Conservation (IMPORTANT)

- **NEVER use Gemini for internal code searches** (codesearch, grep, file search)
- Use `minimax-m2.1:free` for all internal search operations
- Reserve Gemini 2.5 Pro/Flash for: external web research, complex architecture, high-context reasoning

## Kill-Switch

If approaching $20/month on any provider:
1. Stop using paid models immediately
2. Switch all tasks to free alternatives
3. Log in `vscodeportable/research/cost-alerts.md`



## Groq (T4 — Last Resort, Pay-Per-Token)

- **Status**: Last resort ONLY — never primary, never default
- **Cost**: $0.59/$0.79 per 1M tokens (llama-3.3-70b), $0.05/$0.08 (llama-3.1-8b)
- **Rate limits**: 30 RPM, 1K RPD, 100K TPD (llama-3.3-70b)
- **Use when**: T1 free (minimax-m2.1:free + big-pickle) + T2 (Gemini flash) + T3 fail
- **DO NOT use for**: Bulk coding, docs, testing — use T1 free instead

## References

- `.agents/rules/cost-optimization.md` (BMAD Squad mirror)
- `.clinerules/skills/cost-optimization.md` (Cline mirror)
- `.gemini/rules/cost-optimization.md` (Gemini-CLI mirror)
- https://kilo.ai/docs/code-with-ai/agents/free-and-budget-models