---
import type { Language } from '../../i18n/translations';
import { getLangFromUrl, translations } from '../../i18n/translations';
import ThemeSelector from './ThemeSelector.astro';

interface Props {
  lang?: Language;
}

const { lang: propLang } = Astro.props;
const lang = propLang || getLangFromUrl(Astro.url);
const t = translations[lang];

const currentPath = Astro.url.pathname;
const isCs = lang === 'cs';

const navItems = [
  { href: isCs ? '/cs' : '/', label: t.nav.home, key: 'home' },
  { href: isCs ? '/cs/projects' : '/projects', label: t.nav.projects, key: 'projects' },
  { href: isCs ? '/cs/services' : '/services', label: t.nav.services, key: 'services' },
  { href: isCs ? '/cs#about' : '/#about', label: t.nav.about, key: 'about' },
  { href: isCs ? '/cs#contact' : '/#contact', label: t.nav.contact, key: 'contact' },
];

const langSwitchHref = isCs ? currentPath.replace('/cs', '') || '/' : `/cs${currentPath}`;
---

<header
  class="sticky top-0 z-50 bg-white/80 dark:bg-dark-900/80 backdrop-blur-md border-b border-gray-200 dark:border-dark-700"
>
  <nav class="container mx-auto px-4 sm:px-6 lg:px-8" aria-label="Main navigation">
    <div class="flex items-center justify-between h-16">
      <!-- Logo -->
      <a href={isCs ? '/cs' : '/'} class="flex items-center space-x-2" aria-label="Home">
        <span class="text-xl font-bold gradient-text"> Pavel Kašpar </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-8">
        {
          navItems.map((item) => (
            <a
              href={item.href}
              class={`text-sm font-medium transition-colors duration-200 hover:text-primary-600 dark:hover:text-primary-400 ${
                currentPath === item.href ||
                (item.key === 'home' && (currentPath === '/' || currentPath === '/cs'))
                  ? 'text-primary-600 dark:text-primary-400'
                  : 'text-gray-600 dark:text-gray-300'
              }`}
              aria-current={currentPath === item.href ? 'page' : undefined}
            >
              {item.label}
            </a>
          ))
        }
      </div>

      <!-- Language Toggle & Theme Selector -->
      <div class="flex items-center space-x-4">
        <!-- Language Switcher -->
        <a
          href={langSwitchHref}
          class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"
          aria-label={isCs ? 'Switch to English' : 'Přepnout do češtiny'}
        >
          {isCs ? 'EN' : 'CS'}
        </a>

        <!-- Theme Selector (Dropdown) -->
        <ThemeSelector lang={lang} />

        <!-- Mobile Menu Button -->
        <button
          type="button"
          class="md:hidden p-2 text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-dark-800"
          aria-label="Open mobile menu"
          aria-expanded="false"
          id="mobile-menu-button"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div class="md:hidden hidden" id="mobile-menu">
      <div class="mobile-menu-overlay" id="mobile-menu-overlay"></div>
      <div class="mobile-menu-panel" id="mobile-menu-panel">
        <div class="px-2 pt-2 pb-3 space-y-1">
          {
            navItems.map((item) => (
              <a
                href={item.href}
                class={`block px-3 py-2 rounded-md text-base font-medium transition-colors duration-200 ${
                  currentPath === item.href
                    ? 'bg-primary-50 dark:bg-primary-900/20 text-primary-600 dark:text-primary-400'
                    : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-dark-800'
                }`}
                aria-current={currentPath === item.href ? 'page' : undefined}
              >
                {item.label}
              </a>
            ))
          }
        </div>
      </div>
    </div>
  </nav>
</header>
